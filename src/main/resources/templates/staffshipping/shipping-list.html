<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Shipping Management</title>
    <link rel="stylesheet" th:href="@{/css/OrderStyle.css}">
</head>
<body>

<div th:replace="~{layout/header-staff :: header-staff}"></div>
<div class="container">
    <h2>Shipping Management (Ready & Delivering Orders)</h2>

    <div th:if="${error}" class="alert alert-danger"> <p th:text="${error}"></p> </div>
    <div th:if="${success}" class="alert alert-success"> <p th:text="${success}"></p> </div>
    <div th:if="${info}" class="alert alert-info"> <p th:text="${info}"></p> </div>

    <table>
        <thead>
        <tr>
            <th>Order ID</th>
            <th>Recipient Name</th>
            <th>Phone</th>
            <th>Shipping Address</th>
            <th>Ready Since / Delivering Since</th>
            <th>Current Status</th>
            <th>Update Status</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="order : ${shippingOrders}">
            <td th:text="${order.orderId}"></td>
            <td th:text="${order.shippingFullName}"></td>
            <td th:text="${order.shippingPhone}"></td>
            <td th:text="${order.shippingAddress}"></td>
            <td th:text="${order.status == 'Delivering' and order.shipmentReceivedDate != null} ?
                         ${#dates.format(order.shipmentReceivedDate, 'dd/MM/yyyy HH:mm')} :
                         (${order.readyToShipDate != null} ? ${#dates.format(order.readyToShipDate, 'dd/MM/yyyy HH:mm')} : '-')">
            </td>
            <td>
                 <span class="status-badge"
                       th:classappend="${order.status == 'Ready to Ship' ? 'status-ready' : 'status-delivering'}"
                       th:text="${order.status}"></span>
            </td>
            <td>
                <form th:action="@{'/staff/shipping/update-status/' + ${order.orderId}}" method="post" class="status-form" style="display:inline-flex; align-items: center;">
                    <select name="newStatus">
                        <option th:value="${order.status}" th:text="${order.status}" selected disabled>Current Status</option>

                        <option th:if="${order.status == 'Ready to Ship'}" value="Delivering">Mark as Delivering</option>

                        <option th:if="${order.status == 'Delivering'}" value="Completed">Mark as Completed</option>

                        <option th:if="${order.status == 'Delivering'}" value="Delivery Failed">Mark as Delivery Failed</option>

                        <option th:if="${order.status == 'Ready to Ship' or order.status == 'Delivering'}" value="Cancelled">Mark as Cancelled</option>
                    </select>
                    <button type="submit" class="save-btn">Update</button>
                </form>
            </td>
        </tr>
        <tr th:if="${#lists.isEmpty(shippingOrders)}">
            <td colspan="7" style="text-align: center;">No orders currently in the shipping queue.</td>
        </tr>
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <a th:href="@{/orders/list}" class="back-btn">‚Üê Back to All Orders</a>
    </div>

</div>

</body>
</html>