<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer List</title>
    <link rel="stylesheet" th:href="@{/css/StaffStyle.css}">
</head>
<body>

<div>
    <!-- Header -->
    <div sec:authorize="hasRole('ADMIN')"
         th:replace="layout/header-admin :: header-admin"></div>

    <div sec:authorize="hasRole('STAFF')"
         th:replace="layout/header-staff :: header-staff"></div>

    <div sec:authorize="hasRole('CUSTOMER')"
         th:replace="layout/header-customer :: header-customer"></div>

    <!-- Content -->
    <div class="content">
        <h2>Customer List</h2>

        <!-- Search + Filter + Add -->
        <div class="search-sort-container">

            <!-- Left: Search -->
            <div class="search-left">
                <form th:action="@{/customer/list}" method="get" class="search-form">
                    <input type="text" name="searchQuery" placeholder="Search by phone or email"
                           th:value="${searchQuery}"/>
                    <button type="submit" class="btn-filter">Filter</button>
                </form>
            </div>

            <!-- Right: Dropdown + Add -->
            <div class="search-right">
                <form th:action="@{/customer/list}" method="get" class="status-form">
                    <select name="statusFilter" onchange="this.form.submit()">
                        <option value="all" th:selected="${statusFilter == 'all'}">All</option>
                        <option value="active" th:selected="${statusFilter == 'active'}">Active</option>
                        <option value="inactive" th:selected="${statusFilter == 'inactive'}">Inactive</option>
                    </select>
                </form>

                <div class="add-staff">
                    <a href="/customer/add">Add Customer</a>
                </div>
            </div>
        </div>

        <!-- Table -->
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="c : ${customerPage.content}">
                <td th:text="${c.accountId}"></td>
                <td th:text="${c.firstname + ' ' + c.lastname}"></td>
                <td th:text="${c.email}"></td>
                <td th:text="${c.phoneNumber}"></td>
                <td th:text="${c.address}"></td>
                <td>
                    <span th:text="${c.enabled ? 'Active' : 'Inactive'}"
                          th:classappend="${c.enabled ? 'status-active' : 'status-inactive'}"></span>
                </td>
                <td>
                    <a th:href="@{'/customer/view/' + ${c.accountId}}" class="btn-action btn-view">View</a>
                    <a th:href="@{'/customer/edit/' + ${c.accountId}}" class="btn-action btn-edit">Edit</a>
                    <a th:href="@{'/customer/delete/' + ${c.accountId}}"
                       class="btn-action"
                       th:text="${c.enabled ? 'Deactivate' : 'Activate'}"
                       th:classappend="${c.enabled ? 'btn-deactivate' : 'btn-activate'}"
                       onclick="return confirm('Are you sure to change status?')"></a>
                </td>
            </tr>
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="pagination">
            <a th:if="${customerPage.hasPrevious()}"
               th:href="@{/customer/list(page=${customerPage.number - 1}, size=${customerPage.size}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}">
                ← Prev
            </a>

            <span th:each="i : ${#numbers.sequence(0, customerPage.totalPages - 1)}">
                <a th:if="${i == 0 or i == customerPage.totalPages - 1 or (i >= customerPage.number - 1 and i <= customerPage.number + 1)}"
                   th:href="@{/customer/list(page=${i}, size=${customerPage.size}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}"
                   th:text="${i + 1}"
                   th:classappend="${i == customerPage.number} ? 'active'"></a>

                <span th:if="${i == customerPage.number - 2 or i == customerPage.number + 2}">...</span>
            </span>

            <a th:if="${customerPage.hasNext()}"
               th:href="@{/customer/list(page=${customerPage.number + 1}, size=${customerPage.size}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}">
                Next →
            </a>
        </div>

    </div>
</div>

</body>
</html>
