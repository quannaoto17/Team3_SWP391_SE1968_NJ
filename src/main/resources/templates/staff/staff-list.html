<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Staff List</title>
    <link rel="stylesheet" th:href="@{/css/StaffStyle.css}">
</head>
<body>

<!-- Header phân quyền -->
<div sec:authorize="!isAuthenticated()" th:replace="layout/header-default :: header-default"></div>
<div sec:authorize="hasRole('ADMIN')" th:replace="layout/header-admin :: header-admin"></div>
<div sec:authorize="hasRole('STAFF')" th:replace="layout/header-staff :: header-staff"></div>
<div sec:authorize="hasRole('CUSTOMER')" th:replace="layout/header-customer :: header-customer"></div>

<!-- Header -->
<div class="header">
    <h2>Admin Dashboard</h2>
</div>

<!-- Main Content -->
<div class="content">
    <h2>Staff List</h2>

    <!-- Search + Filter + Add -->
    <div class="search-sort-container">
        <!-- Search -->
        <div class="search-left">
            <form th:action="@{/staff/list}" method="get" class="search-form">
                <input type="text" name="searchQuery" placeholder="Search by phone or email"
                       th:value="${searchQuery}"/>
                <button type="submit" class="btn-filter">Search</button>
            </form>
        </div>

        <!-- Filter + Add -->
        <div class="search-right">
            <form th:action="@{/staff/list}" method="get" class="status-form">
                <select name="statusFilter" onchange="this.form.submit()">
                    <option value="all" th:selected="${statusFilter == 'all'}">All</option>
                    <option value="active" th:selected="${statusFilter == 'active'}">Active</option>
                    <option value="inactive" th:selected="${statusFilter == 'inactive'}">Inactive</option>
                </select>
            </form>

            <div class="add-staff">
                <a href="/staff/add">Add Staff</a>
            </div>
        </div>
    </div>

    <!-- TABLE SCROLL WRAPPER -->
    <div class="table-scroll">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="s : ${staffPage.content}">
                <td th:text="${s.accountId}"></td>
                <td th:text="${s.firstname + ' ' + s.lastname}"></td>
                <td th:text="${s.email}"></td>
                <td th:text="${s.phoneNumber}"></td>
                <td th:text="${s.address}"></td>
                <td>
                    <span th:text="${s.enabled ? 'Active' : 'Inactive'}"
                          th:classappend="${s.enabled ? 'status-active' : 'status-inactive'}"></span>
                </td>
                <td>
                    <a th:href="@{'/staff/view/' + ${s.accountId}}" class="btn-action btn-view">View</a>
                    <a th:href="@{'/staff/edit/' + ${s.accountId}}" class="btn-action btn-edit">Edit</a>
                    <a th:href="@{'/staff/delete/' + ${s.accountId}}"
                       class="btn-action"
                       th:text="${s.enabled ? 'Deactivate' : 'Activate'}"
                       th:classappend="${s.enabled ? 'btn-deactivate' : 'btn-activate'}"
                       onclick="return confirm('Are you sure to change status?')"></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- PAGINATION -->
    <div class="pagination">

        <!-- Prev -->
        <a th:if="${currentPage > 1}"
           th:href="@{/staff/list(page=${currentPage - 1}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}">
            « Prev
        </a>

        <!-- Page 1 -->
        <a th:href="@{/staff/list(page=1, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}"
           th:classappend="${currentPage == 1} ? 'active'">
            1
        </a>

        <!-- ... LEFT -->
        <span th:if="${totalPages > 3 and currentPage > 2}">...</span>

        <!-- CURRENT PAGE (not 1 or last) -->
        <a th:if="${currentPage != 1 and currentPage != totalPages}"
           th:text="${currentPage}"
           class="active"
           th:href="@{/staff/list(page=${currentPage}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}">
        </a>

        <!-- ... RIGHT -->
        <span th:if="${totalPages > 3 and currentPage < totalPages - 1}">...</span>

        <!-- LAST PAGE -->
        <a th:if="${totalPages > 1}"
           th:text="${totalPages}"
           th:classappend="${currentPage == totalPages} ? 'active'"
           th:href="@{/staff/list(page=${totalPages}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}">
        </a>

        <!-- Next -->
        <a th:if="${currentPage < totalPages}"
           th:href="@{/staff/list(page=${currentPage + 1}, size=${pageSize}, searchQuery=${searchQuery}, statusFilter=${statusFilter})}">
            Next »
        </a>
    </div>

</div>

</body>
</html>
