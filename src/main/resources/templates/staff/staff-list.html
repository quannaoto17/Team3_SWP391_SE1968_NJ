<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Staff List</title>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Arial,sans-serif;background:#f6f7fb;color:#333}
        .container{width:min(1200px,94%);margin:24px auto;background:#fff;border-radius:10px;padding:24px;box-shadow:0 4px 12px rgba(0,0,0,.08)}
        .container>h2{font-size:22px;color:#4b7bec;margin-bottom:12px}

        .toolbar{display:flex;justify-content:flex-end;margin:10px 0 14px}
        .btn-add{background:#20bf6b;color:#fff;font-weight:600;padding:8px 14px;border-radius:6px;text-decoration:none}
        .btn-add:hover{opacity:.9}

        /* FILTER BAR */
        .filter-bar {display:flex;align-items:center;gap:10px;margin-bottom:12px}
        .filter-bar select {
            padding:6px 10px;
            border-radius:6px;
            border:1px solid #ccc;
            background:#fff;
        }

        .badge{padding:4px 10px;border-radius:999px;font-size:12px;font-weight:600;display:inline-block}
        .badge-active{background:#e6f9ef;color:#16a34a}
        .badge-inactive{background:#fee2e2;color:#dc2626}

        .btn{display:inline-block;text-decoration:none;padding:6px 12px;border-radius:6px;font-size:13px;margin:0 3px;color:#fff;font-weight:500;min-width:70px;text-align:center}
        .btn.btn-sm{padding:6px 10px}
        .btn-view{background:#3867d6}.btn-view:hover{background:#4b7bec}
        .btn-edit{background:#f7b731;color:#1f2937}.btn-edit:hover{background:#fed330;color:#111827}
        .btn-deactivate{background:#eb3b5a}.btn-deactivate:hover{background:#fc5c65}
        .btn-activate{background:#20bf6b}.btn-activate:hover{background:#26de81}

        #staffTable{width:100%;border-collapse:collapse;background:#fff;border:1px solid #ddd}
        #staffTable thead th{background:#f1f1f1;padding:10px;text-align:center;font-weight:600;color:#444;border:1px solid #ddd}
        #staffTable tbody td{padding:10px;text-align:center;border:1px solid #ddd;font-size:14px;vertical-align:middle}
        #staffTable tbody tr:hover{background:#fafafa}
        #staffTable td:last-child{white-space:nowrap !important}

        .dataTables_wrapper{margin-top:12px;font-size:14px}
        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter{margin:8px 0}
        .dataTables_wrapper .dataTables_length select,
        .dataTables_wrapper .dataTables_filter input{border:1px solid #ccc;border-radius:6px;padding:6px 10px;background:#fff}
    </style>
</head>
<body>

<div th:replace="layout/header-admin :: header-admin"></div>

<div class="container">
    <h2>Staff List</h2>

    <div class="toolbar" sec:authorize="hasRole('ADMIN')">
        <a th:href="@{/staff/add}" class="btn-add">+ Add Staff</a>
    </div>

    <!-- ✅ FILTER BAR -->
    <div class="filter-bar">
        <label for="statusFilter">Status:</label>
        <select id="statusFilter">
            <option value="active"   th:selected="${statusFilter == 'active'}">Active</option>
            <option value="inactive" th:selected="${statusFilter == 'inactive'}">Inactive</option>
            <option value="all"      th:selected="${statusFilter == 'all'}">All</option>
        </select>
    </div>

    <table id="staffTable" class="display nowrap" style="width:100%">
        <thead>
        <tr>
            <th>ID</th>
            <th>Tên</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Address</th>
            <th>Status</th>
            <th style="min-width:200px;">Actions</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="s : ${staffPage.content}">
            <td th:text="${s.accountId}">1</td>
            <td th:text="${s.firstname + ' ' + s.lastname}">Nguyen Van A</td>
            <td th:text="${s.email}">staff@shop.com</td>
            <td th:text="${s.phoneNumber}">0888888888</td>
            <td th:text="${s.defaultAddress}">N/A</td>
            <td>
                <span th:classappend="${s.enabled} ? 'badge badge-active' : 'badge badge-inactive'"
                      th:text="${s.enabled} ? 'Active' : 'Inactive'">Active</span>
            </td>
            <td>
                <a th:href="@{'/staff/view/' + ${s.accountId}}" class="btn btn-sm btn-view">View</a>
                <a th:href="@{'/staff/edit/' + ${s.accountId}}" class="btn btn-sm btn-edit">Edit</a>
                <a th:href="@{'/staff/delete/' + ${s.accountId}}"
                   class="btn btn-sm"
                   th:classappend="${s.enabled} ? 'btn-deactivate' : 'btn-activate'"
                   th:text="${s.enabled} ? 'Deactivate' : 'Activate'">Deactivate</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

<script th:inline="none">
    $(function () {

        // ✅ handling filter status
        $('#statusFilter').on('change', function () {
            const status = $(this).val();
            window.location.href = '/staff/list?statusFilter=' + status;
        });

        // ✅ init DataTable
        $('#staffTable').DataTable({
            responsive: true,
            pageLength: 10,
            lengthMenu: [5, 10, 25, 50, 100],
            order: [[0, 'asc']],
            columnDefs: [
                { targets: -1, orderable: false, searchable: false, responsivePriority: 1 },
                { targets: -2, responsivePriority: 2 }
            ],
            language: {
                search: "Tìm:",
                lengthMenu: "Hiển thị _MENU_ dòng",
                info: "Hiển thị _START_–_END_ / _TOTAL_",
                paginate: { previous: "Trước", next: "Sau" },
                zeroRecords: "Không có dữ liệu phù hợp",
                infoEmpty: "Không có bản ghi"
            }
        });
    });
</script>

</body>
</html>
