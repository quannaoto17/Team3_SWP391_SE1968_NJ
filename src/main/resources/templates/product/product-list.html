<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Quản lý sản phẩm</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f6f7fb; }
        .layout { display: grid; grid-template-columns: 240px 1fr; min-height: 100vh; }

        /* Sidebar */
        .sidebar { background: #dcdcdc; padding: 16px; display: flex; flex-direction: column; align-items: center; }
        .sidebar .avatar { width: 80px; height: 80px; border-radius: 50%; background: #bbb; margin-bottom: 12px; }
        .sidebar h3 { margin: 4px 0 20px; }
        .sidebar button { width: 100%; margin: 6px 0; padding: 10px; border: none; border-radius: 4px; background: #fff; cursor: pointer; }
        .sidebar button:hover { background: #ececec; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #fff; border-bottom: 1px solid #ddd; }
        .logout { padding: 8px 12px; border: 1px solid #aaa; background: #fff; cursor: pointer; border-radius: 6px; }

        /* Content */
        .content {
            padding: 20px;
            margin-left: 260px;
        }
        .content h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
        }

        /* Toolbar */
        .toolbar {
            display: flex; align-items: center; gap: 16px; flex-wrap: wrap;
            background: #fff; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 16px;
        }
        .toolbar form { display: flex; align-items: center; gap: 8px; margin: 0; }
        .toolbar input[type="text"] { padding: 8px; width: 280px; border: 1px solid #ccc; border-radius: 6px; }
        .toolbar select { padding: 8px; min-width: 140px; border: 1px solid #ccc; border-radius: 6px; }
        .toolbar button { padding: 8px 12px; cursor: pointer; border-radius: 6px; }
        .toolbar label { font-weight: 600; margin-right: 6px; }
        .toolbar .spacer { flex: 1; }

        /* Table */
        table { width: 100%; border-collapse: collapse; background: #fff; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; vertical-align: middle; }
        th { background: #f1f1f1; }
        tr:hover { background-color: #fafafa; }

        /* Product Image */
        .product-image {
            width: 60px; height: 60px; object-fit: cover;
            border-radius: 6px; box-shadow: 0 0 4px rgba(0,0,0,0.15);
        }

        /* Pagination */
        .pagination { margin-top: 20px; text-align: center; }
        .pagination a { padding: 6px 10px; border: 1px solid #aaa; background: #fff; margin: 0 3px; text-decoration: none; color: black; border-radius: 4px; }
        .pagination a.active { background: #007bff; color: white; }
        .pagination a:hover { background: #0056b3; color: white; }

        .product-link { color: #007bff; text-decoration: none; }
        .product-link:hover { text-decoration: underline; }
        mark { background: #fff3b0; padding: 0 2px; }
    </style>
</head>
<body>

<!-- Header -->
<div th:replace="layout/header-staff :: header-staff"></div>

<!-- Main Content -->
<div class="content">

    <!-- Toolbar: Tìm kiếm + Lọc -->
    <div class="toolbar">
        <!-- Tìm kiếm -->
        <form th:action="@{/staff/products/list}" method="get" id="searchForm" autocomplete="off">
            <input id="searchInput" type="text" name="keyword" placeholder="Tìm kiếm sản phẩm..." th:value="${keyword}">
            <input type="hidden" name="brandId" th:value="${brandId}">
            <input type="hidden" name="categoryId" th:value="${categoryId}">
            <input type="hidden" name="sortField" th:value="${sortField}">
            <input type="hidden" name="sortDir" th:value="${sortDir}">
            <input id="sizeInput" type="hidden" name="size" th:value="${pageSize}">
            <button type="submit">Tìm kiếm</button>
        </form>

        <div class="spacer"></div>

        <!-- Lọc -->
        <form th:action="@{/staff/products/list}" method="get" class="filter-form">
            <label>Lọc theo Thương hiệu:</label>
            <select name="brandId">
                <option value="">Tất cả</option>
                <option th:each="brand : ${brands}"
                        th:value="${brand.brandId}"
                        th:text="${brand.name}"
                        th:selected="${brand.brandId == brandId}"></option>
            </select>

            <label>Lọc theo Danh mục:</label>
            <select name="categoryId">
                <option value="">Tất cả</option>
                <option th:each="category : ${categories}"
                        th:value="${category.categoryId}"
                        th:text="${category.categoryName}"
                        th:selected="${category.categoryId == categoryId}"></option>
            </select>

            <input type="hidden" name="keyword" th:value="${keyword}">
            <input type="hidden" name="sortField" th:value="${sortField}">
            <input type="hidden" name="sortDir" th:value="${sortDir}">
            <input type="hidden" name="size" th:value="${pageSize}">
            <button type="submit">Áp dụng</button>
        </form>
    </div>

    <h2>
        Danh sách sản phẩm
        <a th:href="@{/staff/products/add}">
            <button class="add-btn">➕ Thêm mới</button>
        </a>
    </h2>

    <!-- ===== LIST WRAPPER ===== -->
    <div id="listWrapper" th:fragment="listWrapper">
        <table>
            <thead>
            <tr>
                <th>Mã</th>
                <th>Hình ảnh</th>
                <th>Danh mục</th>
                <th>Thương hiệu</th>
                <th>
                    <a th:href="@{/staff/products/list(page=1,size=${pageSize},sortField='productName',sortDir=${reverseSortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}">
                        Tên sản phẩm
                    </a>
                </th>
                <th>
                    <a th:href="@{/staff/products/list(page=1,size=${pageSize},sortField='price',sortDir=${reverseSortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}">
                        Giá ($)
                    </a>
                </th>
                <th>Trạng thái</th>
                <th>Mô tả</th>
                <th>Thông số kỹ thuật</th>
            </tr>
            </thead>

            <tbody id="productTbody">
            <tr th:if="${products == null or #lists.isEmpty(products)}">
                <td colspan="9" style="text-align:center;color:#777">Không có kết quả</td>
            </tr>

            <tr th:each="product : ${products}">
                <td th:text="${product.productId}"></td>

                <!-- Hiển thị ảnh sản phẩm (chuẩn Thymeleaf + fallback mặc định) -->
                <td>
                    <a th:href="@{/staff/products/edit/{id}(id=${product.productId})}">
                        <img th:if="${product.images != null and !product.images.isEmpty()}"
                             th:src="@{${product.images[0].imageUrl}}"
                             alt="Ảnh sản phẩm" class="product-image"/>

                        <img th:if="${product.images == null or product.images.isEmpty()}"
                             th:src="@{/image/default-product.png}"
                             alt="Không có ảnh" class="product-image"/>
                    </a>
                </td>

                <td th:text="${product.category != null ? product.category.categoryName : 'N/A'}"></td>
                <td th:text="${product.brand != null ? product.brand.name : 'N/A'}"></td>

                <td>
                    <a class="product-link"
                       th:href="@{/staff/products/edit/{id}(id=${product.productId})}"
                       th:text="${product.productName}"></a>
                </td>

                <td th:text="${product.price}"></td>
                <td th:text="${product.status ? 'Còn hàng' : 'Hết hàng'}"></td>
                <td th:text="${product.description}"></td>
                <td th:text="${product.specification}"></td>
            </tr>
            </tbody>
        </table>

        <!-- Phân trang -->
        <div class="pagination">
            <a th:if="${currentPage > 1}"
               th:href="@{/staff/products/list(page=${currentPage - 1},size=${pageSize},sortField=${sortField},sortDir=${sortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}">&laquo; Trước</a>

            <a th:href="@{/staff/products/list(page=1,size=${pageSize},sortField=${sortField},sortDir=${sortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}"
               th:classappend="${currentPage == 1} ? 'active'">1</a>

            <span th:if="${currentPage > 4}">...</span>

            <span th:each="i : ${#numbers.sequence(currentPage - 2, currentPage + 2)}"
                  th:if="${i > 1 and i < totalPages}">
                <a th:href="@{/staff/products/list(page=${i},size=${pageSize},sortField=${sortField},sortDir=${sortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}"
                   th:text="${i}"
                   th:classappend="${i == currentPage} ? 'active'"></a>
            </span>

            <span th:if="${currentPage < totalPages - 3}">...</span>

            <a th:if="${totalPages > 1}"
               th:href="@{/staff/products/list(page=${totalPages},size=${pageSize},sortField=${sortField},sortDir=${sortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}"
               th:text="${totalPages}"
               th:classappend="${currentPage == totalPages} ? 'active'"></a>

            <a th:if="${currentPage < totalPages}"
               th:href="@{/staff/products/list(page=${currentPage + 1},size=${pageSize},sortField=${sortField},sortDir=${sortDir},brandId=${brandId},categoryId=${categoryId},keyword=${keyword})}">Sau &raquo;</a>
        </div>
    </div>
</div>

<script th:src="@{/js/jquery.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
</body>
</html>
