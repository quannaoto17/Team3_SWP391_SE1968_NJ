<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Product Management</title>

    <!-- ‚úÖ DataTables CSS -->
    <link rel="stylesheet"
          href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f6f7fb;
        }

        .content {
            padding: 20px;
            margin-left: 260px;
        }

        h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-bar {
            margin-bottom: 12px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-bar label {
            font-weight: 600;
        }

        .filter-bar select {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            min-width: 160px;
            background-color: #fff;
        }

        table.dataTable {
            width: 100%;
            background: #fff;
            border-collapse: collapse;
        }

        table.dataTable th, table.dataTable td {
            text-align: center;
            padding: 8px;
            vertical-align: middle;
        }

        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);
        }

        .product-link {
            color: #007bff;
            text-decoration: none;
        }

        .product-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<!-- Header -->
<div th:replace="layout/header-staff :: header-staff"></div>

<!-- Main content -->
<div class="content">
    <h2>
        Product List
        <a th:href="@{/staff/products/add}">
            <button class="add-btn">‚ûï Add New</button>
        </a>
    </h2>

    <!-- ‚úÖ Filter bar (Dropdown filters) -->
    <div class="filter-bar">
        <label>üî∏ Filter by Category:</label>
        <select id="categoryFilter">
            <option value="">All</option>
            <option th:each="c : ${categories}"
                    th:value="${c.categoryName}"
                    th:text="${c.categoryName}"></option>
        </select>

        <label>üî∏ Filter by Brand:</label>
        <select id="brandFilter">
            <option value="">All</option>
            <option th:each="b : ${brands}"
                    th:value="${b.name}"
                    th:text="${b.name}"></option>
        </select>

        <label>üî∏ Filter by Status:</label>
        <select id="statusFilter">
            <option value="">All</option>
            <option value="In Stock">In Stock</option>
            <option value="Out of Stock">Out of Stock</option>
        </select>
    </div>

    <!-- ‚úÖ Product Table -->
    <table id="productTable" class="display">
        <thead>
        <tr>
            <th>ID</th>
            <th>Image</th>
            <th>Category</th>
            <th>Brand</th>
            <th>Product Name</th>
            <th>Price ($)</th>
            <th>Status</th>
            <th>Description</th>
            <th>Specification</th>
        </tr>
        </thead>

        <tbody>
        <tr th:if="${products == null or #lists.isEmpty(products)}">
            <td colspan="9" style="text-align:center;color:#777">No results found</td>
        </tr>

        <tr th:each="product : ${products}">
            <td th:text="${product.productId}"></td>

            <td>
                <img th:if="${product.images != null and !product.images.isEmpty()}"
                     th:src="@{${product.images[0].imageUrl}}"
                     alt="Product Image" class="product-image"/>
                <img th:if="${product.images == null or product.images.isEmpty()}"
                     th:src="@{/image/default-product.png}"
                     alt="No Image" class="product-image"/>
            </td>

            <td th:text="${product.category != null ? product.category.categoryName : 'N/A'}"></td>
            <td th:text="${product.brand != null ? product.brand.name : 'N/A'}"></td>

            <td>
                <a class="product-link"
                   th:href="@{/staff/products/edit/{id}(id=${product.productId})}"
                   th:text="${product.productName}"></a>
            </td>

            <td th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 2, 'POINT')}"></td>
            <td th:text="${product.status ? 'In Stock' : 'Out of Stock'}"></td>
            <td th:text="${product.description}"></td>
            <td th:text="${product.specification}"></td>
        </tr>
        </tbody>
    </table>
</div>

<!-- ‚úÖ jQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<!-- ‚úÖ Initialize DataTables + Dropdown filters -->
<script>
    $(document).ready(function() {
        // Initialize DataTable
        var table = $('#productTable').DataTable({
            pageLength: 10,
            searching: true,
            ordering: true,
            lengthMenu: [5, 10, 25, 50],
            language: {
                search: "üîç Search:",
                lengthMenu: "Show _MENU_ products",
                info: "Showing _START_‚Äì_END_ of _TOTAL_ products",
                zeroRecords: "No matching products found",
                paginate: { first: "First", last: "Last", next: "‚Üí", previous: "‚Üê" }
            }
        });

        // üü° Filter by Category
        $('#categoryFilter').on('change', function () {
            table.column(2).search(this.value).draw(); // Category column (index 2)
        });

        // üü° Filter by Brand
        $('#brandFilter').on('change', function () {
            table.column(3).search(this.value).draw(); // Brand column (index 3)
        });

        // üü° Filter by Status
        $('#statusFilter').on('change', function () {
            table.column(6).search(this.value).draw(); // Status column (index 6)
        });
    });
</script>

</body>
</html>
